# Adaptive Momentum & Contrarian Strategy (OMX Helsinki)

## Overview
This project implements a comprehensive backtesting engine for quantitative trading strategies on the **OMX Helsinki All-Share** index. It focuses on **Adaptive Momentum** and **Contrarian** (Value) strategies, incorporating advanced features like **Buffered Turnover Reduction**, **Trend Filtering**, and **Volatility Scaling**.

The core "Thesis Strategy" dynamically switches between:
-   **Contrarian Long** (Value) in **January** (exploiting the January Effect).
-   **Momentum** (Winners) from **February to December**, protected by a Trend Filter (SMA10).

## Features
-   **Bloomberg Integration**: Automated data fetching via `Rblpapi` (Price, Volume, Fundamental Data, Index, V2X).
-   **Survivorship Bias Free**: Includes delisted companies via `dead_tickers.csv` with realistic bankruptcy/acquisition handling.
-   **Realistic Backtesting**:
    -   Transaction costs: 0.25% (slippage + commission).
    -   Liquidity filters: > €25k daily turnover, > €25M Market Cap.
    -   **Buffered Engine**: Reduces churn by using separate Buy/Sell thresholds (e.g., Buy Top 20, Hold until drops below Top 25).
-   **Hypothesis Testing**:
    -   **H1 (January Effect)**: Statistical validation of Value outperformance in January.
    -   **H2 (Momentum Supremacy)**: Validation of Momentum dominance in Bull markets (Feb-Dec).
    -   **H3 (Trend Protection)**: Stress-testing downside protection using SMA10 trend filter.
-   **Automated Reporting**: Generates PDF visualizations for heatmaps, stress tests, and performance graphs.

## Prerequisites

### Software
-   **R** (Version 4.0 or higher)
-   **Bloomberg Terminal** (Required for fresh data download)

### R Packages
The script automatically installs `pacman` and loads the following dependencies:
-   `Rblpapi` (Bloomberg API)
-   `tidyverse` (Data manipulation & ggplot2)
-   `tidyquant` (Financial data tools)
-   `PerformanceAnalytics` (Risk/Return metrics)
-   `xts` (Time series handling)
-   `lubridate` (Date manipulation)
-   `gridExtra` (Plotting layouts)

## Files

| File | Description |
|------|-------------|
| `PortmanMasterScript.R` | The master execution script containing all logic (Data Fetch, Cleaning, Strategy Engine, Visualization). |
| `dead_tickers.csv` | List of delisted tickers to prevent survivorship bias. |
| `omxh_thesis_data.rds` | Cached data file to run the script without an active Bloomberg connection. |
| `*.pdf` | Various output reports generated by the script (e.g., `Thesis_FINAL_Graph.pdf`, `January_Effect.pdf`). |

## Usage

1.  **Open the project** in RStudio.
2.  **Configuration** (Top of `PortmanMasterScript.R`):
    -   Set `DOWNLOAD_NEW_DATA <- TRUE` if you have a Bloomberg Terminal and need fresh data.
    -   Set `DOWNLOAD_NEW_DATA <- FALSE` to use the cached `omxh_thesis_data.rds`.
3.  **Run the script**:
    ```r
    source("PortmanMasterScript.R")
    ```
4.  **Outputs**:
    -   Console: Prints statistical test results (t-tests for H1, H2, H3) and Sharpe ratios.
    -   Files: PDF charts are saved to the working directory.

## Strategy Logic Details

### Buffered Momentum Engine
To mimic realistic fund management behavior, the script uses a **Buffer** to avoid excessive trading.
-   **Buy Rule**: Enter stock if Rank <= `n_buy` (e.g., Top 20).
-   **Sell Rule**: Exit stock only if Rank > `n_sell` (e.g., Drops below Top 25).
-   **Cost Model**: Costs are applied dynamically based on actual portfolio turnover.

### The "Thesis" Strategy
1.  **January**: **Long Losers** (Contrarian).
    -   *Logic*: Tax-loss harvesting reversals.
    -   *Penalty*: Includes an extra "Liquidity Penalty" to model difficulty in trading distressed assets.
2.  **Feb-Dec**: **Long Winners** (Momentum).
    -   *Filter*: Only invest if Index Price > SMA10 (Bull Trend).
    -   *Fallback*: If Index < SMA10 (Bear Trend), switch to Risk-Free Rate (Cash).
    -   *Sizing*: Volatility-scaled position (optional flag `USE_VOL_SCALED_THESIS`).

## Disclaimer
This code is for educational and research purposes only. It is not financial advice.
